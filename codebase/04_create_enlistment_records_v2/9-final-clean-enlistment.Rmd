---
title: "9-final-clean-enlistment"
output: html_document
date: "2023-03-02"
---

```{r}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(dplyr)   # %>%, group_by, tally, print
library(ipumsr)  # read_ipums_ddi, ipums_val_labels
library(readr)   # read_csv, write_csv
library(stringr) # str_trim, str_split
```

#update path
```{r}
path_to_temp_data   <-  "/data/josh/CenSoc/censoc_data/enlistment-records-public/code/awenlistmentcode/temp8.csv"
out_path <- "/data/josh/CenSoc/censoc_data/enlistment-records-public/code/awenlistmentcode"
```

```{r}
data_combined <- read_csv(path_to_temp_data, 
                          col_types = cols(
                            empty_field = col_character(),
                            term_or_enlistment = col_character(),
                            longevity = col_character(),
                            education = col_character(),
                            marital_status = col_character(),
                            component = col_character(),
                            educ_spec = col_character(),
                            defer_date_mmyy = col_character(),
                            mname_clean = col_character(),
                            sex = col_integer(),
                            sex_r = col_integer(),
                            fname_std = col_character()
                            )
                          )
```

#Create final df using the subset function and rename columns
```{r}
colnames(data_combined)

enlistment_records_final_v1 <- subset(data_combined, select = c( "serial_number",  "yob_precise", "fname_clean" , "mname_clean" ,"lname_clean", "sex_r", "date_of_enlistment_ddmmyyyy", "nativity_clean" , "residence_county", "residence_state", "place_of_enlistment","education_recode$education_recode","grade_recode$grade_code_recode",  "branch_recode$branch_code_recode", "term_or_enlistment_recode$term_or_enlistment_recode", "race_recode$race_recode", "citizenship_recode$citizenship_recode", "civ_occupation_recode" ,"marital_status_recode$marital_status_recode", "ht_recode", "weight" ,"component_recode$component_recode","source_recode$source_recode"))

```
#test df by looking at the first 200 rows
```{r}
head(enlistment_records_final_v1, 200)
```
#rename columns
```{r}
enlistment_records_final_v1 <- enlistment_records_final_v1 %>% 
        rename("sex" ="sex_r" , 
               "yob" = "yob_precise" ,
               "fname" = "fname_clean",
               "mname" = "mname_clean",
               "lname" = "lname_clean",
               "place_of_birth" = "nativity_clean" ,
               "weight_or_AGCT" = "weight" , 
               "source" = "source_recode$source_recode" ,
               "grade_code" = "grade_recode$grade_code_recode" , 
              "term_of_enlistment" = "term_or_enlistment_recode$term_or_enlistment_recode" , 
              "branch_code" = "branch_recode$branch_code_recode" ,
              "component" = "component_recode$component_recode" , 
               "race" = "race_recode$race_recode", 
               "citizenship" = "citizenship_recode$citizenship_recode", 
               "education" = "education_recode$education_recode" ,
               "marital_status" = "marital_status_recode$marital_status_recode" , 
               "height" = "ht_recode",
               "civilian_occupation" = "civ_occupation_recode" )
```


#save final dataset
```{r}
write_csv(enlistment_records_final_v1, paste0(out_path, "/finalenlistment.csv"))
rm(list = ls())
```

