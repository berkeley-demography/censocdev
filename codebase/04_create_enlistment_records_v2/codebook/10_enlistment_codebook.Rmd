
title: "CenSoc-DMF-WW2-Army-Enlistment File Codebook[^updated]"
output:
  pdf_document: default
  html_notebook: default
  html_document:
    df_print: paged
  word_document: default
header-includes: \usepackage{hyperref}
---

[^updated]: Last updated: `r format(Sys.time(), '%d %B, %Y')`


| Page| Variable     | Label                                        |
|----:|:-------------|:---------------------------------------------|
|   \hyperlink{page.2}{2}  | \hyperlink{page.2}{serial\_number}         |Army Serial Number  |
|   \hyperlink{page.3}{3}  | \hyperlink{page.3}{yob}           |Year of Birth    |
|   \hyperlink{page.4}{4}  | \hyperlink{page.4}{fname}           |First Name                      |
|   \hyperlink{page.5}{5}  |\hyperlink{page.5}{mname}            |Middle Name                      |
|   \hyperlink{page.6}{6}  | \hyperlink{page.6}{lname}          |Last Name                  |
|   \hyperlink{page.7}{7}  |\hyperlink{page.7}{sex}             |Sex              |
|   \hyperlink{page.8}{8}  | \hyperlink{page.8}{date\_of\_enlistment\_ddmmyyyy}  |Date of Enlistment     |
|  \hyperlink{page.9}{9} |\hyperlink{page.9}{place\_of_\birth}              |Place of Birth |
|  \hyperlink{page.10}{10} |\hyperlink{page.10}{residence\_state}           |State of Residence at Enlistment|
|  \hyperlink{page.11}{11} |\hyperlink{page.11}{residence\_county}           |County of Residence at Enlistment|
|  \hyperlink{page.12}{12} |\hyperlink{page.12}{place\_of\_enlistment}          |Place of Enlistment|
|  \hyperlink{page.13}{13} |\hyperlink{page.13}{education}                   |Education |
|  \hyperlink{page.14}{14} |\hyperlink{page.14}{grade\_code}                    |Army Grade (rank)|
|  \hyperlink{page.15}{15} |\hyperlink{page.15}{branch\_code}                     |Army Branch |
|  \hyperlink{page.16}{16} |\hyperlink{page.16}{term\_of\_enlistment}            |Term of Enlistment |
|  \hyperlink{page.17}{17} |\hyperlink{page.17}{race}    |Race  |
|  \hyperlink{page.18}{18} |\hyperlink{page.18}{citizenship}                 |Citizenship  |
|  \hyperlink{page.19}{19} |\hyperlink{page.19}{civilian_\occupation}            |Civilian Occupation |
|  \hyperlink{page.20}{20} |\hyperlink{page.20}{marital\_status}            |Marital Status at Enlistment |
|  \hyperlink{page.21}{21} |\hyperlink{page.21}{height}                |Height at Enlistment (inches) |
|  \hyperlink{page.22}{22} |\hyperlink{page.22}{weight\_or\_AGCT}                |Weight (pounds) at Enlistment or AGCT
score|
|  \hyperlink{page.23}{23} |\hyperlink{page.23}{component\_enlistment}             |Army component |
|  \hyperlink{page.24}{24} |\hyperlink{page.24}{source}                          |Source of Army Personnel |

**Summary:** The CenSoc-DMF-WW2-Army-Enlistment File (N = 1,541,899) links the full-count 1940 Census to the Social Security Death Master File (DMF) and the National Archivesâ€™ public release of the United States World War II Army Enlistment Records, circa 1938-1946. Records were linked using the standard variant of the ABE method developed by Abramitzky, Boustan, and Eriksson (2012, 2014, 2017). Variables ending in '_dmf' are from the DMF, and those ending in '_enlistment' are from the Army Enlistment file. To merge 1940 Census data with this data set, researchers can obtain a copy of the 1940 Census from IPUMS-USA and link on the individual-level, unique identifier HISTID variable.



```{r global_options, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
options(kableExtra.auto_format = FALSE, scipen=999)
```

```{r echo = F, results='hide', message=FALSE, warning=FALSE}
## Library Packages
library(tidyverse)
library(data.table)
library(stringi)
library(lubridate)
library(kableExtra)

data_path <- '/data/josh/CenSoc/censoc_data/enlistment-records-public/code/awenlistmentcode/finalenlistment.csv'
resource_file_path <- '/data/josh/CenSoc/censoc_data/enlistment-records-public/code/awenlistmentcode'
path_to_temp_data <- "/data/josh/CenSoc/censoc_data/enlistment-records-public/code/awenlistmentcode/temp2.csv"
out_path          <- "/data/josh/CenSoc/censoc_data/enlistment-records-public/code/awenlistmentcode"
codebook_path <- "/censoc_new/censocdev/codebase/04_create_enlistment_records_v2/10-enlistment-codebook_files"
## read in data file
#setwd(data_path)
#enlistment_dmf <- fread('finalenlistment.csv')


setwd(resource_file_path)
test_file_path <- '/data/josh/CenSoc/censoc_data/enlistment-records-public/code/awenlistmentcode'
enlistment_records_final <- fread('finalenlistment.csv')



```
```{r}
#read in temp2
data_combined <- read_csv(path_to_temp_data, 
                          col_types = cols(
                            empty_field = col_character(),
                            term_or_enlistment = col_character(),
                            longevity = col_character(),
                            education = col_character(),
                            marital_status = col_character(),
                            component = col_character(),
                            educ_spec = col_character(),
                            defer_date_mmyy = col_character(),
                            mname_clean = col_character(),
                            sex = col_integer(),
                            sex_r = col_integer(),
                            fname_std = col_character()
                            )
                          )

```



\newpage

**\huge serial_number**
\normalsize
\vspace{12pt}

**Label**: Army Serial Number

**Description**: serial_number is an assigned number.




\newpage 

**\huge yob **
\normalsize
\vspace{12pt}

**Label**: Year of Birth 

**Description**: yob reports a person's year of birth, as recorded in the Social Security Death Master File.  

```{r, include = F}
byear_plot <- enlistment_records_final %>%
    group_by(yob) %>%
    summarise(n = n()) %>%
    ggplot(aes(x = yob, y = n)) + 
    geom_line() + 
    geom_point() +
    theme_minimal(base_size = 15) + #replace with a different theme (theme_bw()) if the bbplot package isn't downloaded 
  ggtitle("Year of Birth") + 
  theme(legend.position="bottom") +
  xlab("title") + 
  labs(x = "Year", 
       y = "Count") + 
  scale_y_continuous(labels = scales::comma, limits = c(0, 110000)) +
  scale_x_continuous(breaks = scales::pretty_breaks(n=5)) 
```

\vspace{75pt}

```{r, echo = F}
byear_plot
```




\newpage 
**\huge fname **
\normalsize
\vspace{12pt}

**Label:** First Name

**Description:** fname, utilized ABE cleaning method.  





\newpage 

**\huge mname **
\normalsize
\vspace{12pt}

**Label**: Middle Name

**Description**: mname reports a person's middle name, utilized ABE cleaning method.     







\newpage 

**\huge lname **
\normalsize
\vspace{12pt}

**Label**: Last Name

**Description**: lname reports a persons last name cleaned, utilized ABE cleaning method.


\vspace{30pt}




\newpage
**\huge sex **
\normalsize
\vspace{12pt}

**Label**: Sex

**Description**: sex reports a person's sex, as recorded in the Social Security Death Master File.    

```{r, include = F}
sex_tabulated <- knitr::kable(enlistment_records_final %>%
    group_by(sex) %>%
     tally() %>%
     mutate(freq = signif(n*100 / sum(n), 3)) %>%
     mutate(label = c("Men")) %>%
     select(sex, label, n, `freq %` = freq))
```

\vspace{75pt}


\newpage


**\huge date_of_enlistment_ddmmyyyy **
\normalsize
\vspace{12pt}

**Label:** Date of Enlistment 

**Description**: date_of_enlistment_ddmmyyyy reports a person's date of enlistment in dd-mm-yyyy format, as reported in the World War II Army Enlistment Records. 
```{r}
min(data_combined$year_of_birth, na.rm=T) # "00"
max(data_combined$year_of_birth, na.rm=T) # "99"

data_combined %>%
  group_by(year_of_birth) %>%
  tally() %>%
  print(n=101)

split_date_of_enlistment_ddmmyy <- function(row) {
  dd <- substr(row, 1, 2)
  mm <- substr(row, 3, 4)
  yy <- substr(row, 5, 6)
  return(list(dd=dd, mm=mm, yy=yy))}
res <- lapply(data_combined$date_of_enlistment_ddmmyy, split_date_of_enlistment_ddmmyy) # SLOW
data_combined$date_of_enlistment_dd <- unlist(res)[attr(unlist(res), "names") == "dd"]
data_combined$date_of_enlistment_mm <- unlist(res)[attr(unlist(res), "names") == "mm"]
data_combined$date_of_enlistment_yy <- unlist(res)[attr(unlist(res), "names") == "yy"]
rm(res)

min(data_combined$date_of_enlistment_yy, na.rm=T) # "00"
max(data_combined$date_of_enlistment_yy, na.rm=T) # "99"

data_combined %>%
  group_by(date_of_enlistment_yy) %>%
  tally() %>%
  print(n=100)

nrow(subset(data_combined, date_of_enlistment_yy < "38" | date_of_enlistment_yy > "46")) # 41896

## create new date variable 
data_combined <- data_combined %>% 
  mutate(date_of_enlistment_yy = as.numeric(date_of_enlistment_yy) + 1900) %>% 
  mutate(date_enlistment_recode = make_date(date_of_enlistment_yy, date_of_enlistment_mm, date_of_enlistment_dd))

## check dates look reasonable and are in yyyy-mm-dd format (match v1 release)
data_combined %>%
  count(date_enlistment_recode) %>% 
  arrange(desc(n))

## visualize distribution (loooks reasonable - identical pattern to v1 release)
data_combined %>%
  filter(date_of_enlistment_yy %in% c(1938:1947)) %>% ## restrict to years around WWII 
  mutate(date_short = format(as.Date(date_enlistment_recode), "%Y-%m")) %>% 
    group_by(date_short) %>% 
    tally() %>% 
    filter(!is.na(date_short)) %>%
  ggplot(aes(x=date_short, y=n, group=1)) +
  geom_line() +
  geom_point() +
  scale_x_discrete(breaks = paste0(seq(1938, 1947, 1), "-01")) +
  theme_minimal(base_size = 15) +
  ggtitle("Enlistment Date (Month and Year Only)") +
  labs(x = "Date (yyyy-mm)", 
       y = "Count") + 
  scale_y_continuous(labels = scales::comma) +
  theme(axis.text.x = element_text(angle = 45))
```
\vspace{30pt}



\newpage

**\huge place_of_birth **
\normalsize
\vspace{12pt}

**Label**: Place of Birth 

**Description**: place_of_birth reports a person's place of birth at time of enlistment, as reported in the World War II Army Enlistment Records.

For a complete list of codes, please see: https://aad.archives.gov/aad/popup-codelist.jsp?cl_id=2079&dt=893&c_id=24982



\newpage 

**\huge residence_state **
\normalsize
\vspace{12pt}

**Label**: State of residence

**Description**: residence_state is a variable that reports a person's state of residence at time of enlistment, as reported in the World War II Army Enlistment Records. This variable is only available for enlistees residing in the US.

For a complete list of codes, please see: https://aad.archives.gov/aad/popup-codelist.jsp?cl_id=2057&dt=893&c_id=24998


\newpage 

**\huge residence_county **
\normalsize
\vspace{12pt}

**Label**: County of residence

**Description**: residence_county is a numeric variable that reports a person's county of residence at time of enlistment, as reported in the World War II Army Enlistment Records. This variable is only available for enlistees residing in the US.

For a complete list of codes, please see: https://aad.archives.gov/aad/popup-codelist.jsp?cl_id=2057&dt=893&c_id=24998



\newpage 

**\huge place_of_enlistment **
\normalsize
\vspace{12pt}

**Label**: Place of enlistment

**Description**: place_of_enlistment_enlistment is a numeric variable that reports where an person enlisted, as reported in the World War II Army Enlistment Records. 

For a complete list of codes, please see: https://aad.archives.gov/aad/popup-codelist.jsp?cl_id=4123&dt=893&c_id=24997




\newpage 

**\huge education **
\normalsize
\vspace{12pt}

**Label**: Education

**Description**: education  is a numeric variable that reports an individual's educational attainment at time of enlistment, as reported in the World War II Army Enlistment Records.
For a complete list of codes, please see: https://usa.ipums.org/usa-action/variables/EDUC#codes_section



\newpage 

**\huge grade_code**
\normalsize
\vspace{12pt}

**Label**: Army grade ((alphanumeric code)rank)

**Description**: grade_code is a string variable that records a person's grade (rank), as reported in the World War II Army Enlistment Records. 

```{r}
grades <- fread('cl_2072.csv')
grade_tabulated <- enlistment_records_final %>%
  group_by(grade_code) %>%
  tally() %>%
  left_join(grades %>% mutate(Code = as.integer(Code)), by = c('grade_code' = 'Code')) %>%
  mutate(freq = signif(n * 100 / sum(n), 3), `freq %` = paste0(freq, "%")) %>%
  select(grade_code, label = Meaning, n, `freq %`)

# print the resulting table
knitr::kable(grade_tabulated)
```


\vspace{30pt}

```{r}
grade_tabulated
```


Code list also is available at: https://aad.archives.gov/aad/popup-codelist.jsp?cl_id=2072&dt=893&c_id=24999



\newpage 

**\huge branch_code**
\normalsize
\vspace{12pt}

**Label**: Army branch (alphanumeric code)

**Description**: branch_code is a numeric variable that records the army branch in which the enlistee served, as reported in the World War II Army Enlistment Records. 

```{r}
branches <- fread('cl_2075.csv')
branch_tabulated <- knitr::kable(enlistment_records_final %>%
                          group_by(branch_code) %>% 
                          tally() %>% 
                          left_join(branches, by=c('branch_code' = 'Code')) %>%
                          mutate(freq = signif(n*100 / sum(n), 3)) %>% 
                          select('branch_code'= branch_code, 'label' = Meaning, n, `freq %` = freq),
                          format='latex', booktabs=T) %>% 
  kable_styling(position = "center") %>% 
  column_spec(column=2, width = '9cm')
```

\vspace{10 pt}

```{r}
# check type of codes vs. enlistment data -- may be mismatched
branch_tabulated
```



\newpage 

**\huge term_of_enlistment**
\normalsize
\vspace{12pt}

**Label**: Term of enlistment

**Description**: term_of_enlistment_enlistment is a numeric variable that reports the length of a person's enlistment or their department of enlistment, as reported in the World War II Army Enlistment Records. 

```{r}
term <- fread('cl_2076.csv')
toe_tabulated <- knitr::kable(enlistment_records_final %>%
                          group_by(term_of_enlistment) %>% 
                          tally() %>% 
                          left_join(term, by=c('term_of_enlistment' = 'Code')) %>%
                          mutate(freq = signif(n*100 / sum(n), 3)) %>% 
                          select(term_of_enlistment, 'label' = Meaning, n, `freq %` = freq),
                          format='latex', booktabs=T) %>% 
  kable_styling(position = "center") %>% 
  column_spec(column=2, width = '7cm')
```

\vspace{30 pt}

```{r}
toe_tabulated
```

Codes also available at: https://aad.archives.gov/aad/popup-codelist.jsp?cl_id=2076&dt=893&c_id=24979







\newpage 

**\huge race**
\normalsize
\vspace{12pt}

**Label**: Race

**Description**: race is a string variable that reports an individual's race, as reported in the World War II Army Enlistment Records.

Codes also available at: https://aad.archives.gov/aad/popup-codelist.jsp?cl_id=2059&dt=893&c_id=24984



\newpage 

**\huge citizenship**
\normalsize
\vspace{12pt}

**Label**: Citizenship

**Description**: citizenship is a string variable that reports an individual's citizenship, as reported in the World War II Army Enlistment Records. 1 indicates the individual was a US citizen, 0 indicates a noncitizen.



Codes also available at: https://aad.archives.gov/aad/popup-codelist.jsp?cl_id=2059&dt=893&c_id=24984



\newpage 

**\huge civillian_occupation**
\normalsize
\vspace{12pt}

**Label**: civilian occupation

**Description**: civ_occupation is a string variable that reports a person's occupation at time of enlistment, as reported in the World War II Army Enlistment Records. 

For complete codes, please see: https://aad.archives.gov/aad/popup-codelist.jsp?cl_id=3323&dt=893&c_id=24986




\newpage 

**\huge marital_status**
\normalsize
\vspace{12pt}

**Label**: marital status

**Description**: marital_status is a string variable that reports a person's marital status at time of enlistment, as reported in the World War II Army Enlistment Records. 

```{r}
ms_codes <- fread('cl_2081.csv')
marital_status_tabulated <- knitr::kable(enlistment_records_final %>%
                          group_by(marital_status) %>% 
                          tally() %>% 
                          left_join(ms_codes, by=c('marital_status' = 'Code')) %>%
                          mutate(freq = signif(n*100 / sum(n), 3)) %>% 
                          select(marital_status, 'label' = Meaning, n, `freq %` = freq))
```

\vspace{30pt}

```{r}
marital_status_tabulated
```

Codes also available at: https://aad.archives.gov/aad/popup-codelist.jsp?cl_id=2081&dt=893&c_id=25001




\newpage
**\huge height**
\normalsize
\vspace{12pt}

**Label**: Height

**Description**: height is a numeric variable that reports a person's height in inches at time of enlistment, as reported in the World War II Army Enlistment Records. 

**Note**: Please be aware that instructions on how to use this field on enlistment punch cards varied over time. This field may encode military occupation or other information. Height may have been recorded through about 1943, but height data recorded after February 1943 are likely unreliable. See the [\textcolor{blue}{National Archives' technical documentation on the Amy Serial Number Electronic File}](https://catalog.archives.gov/OpaAPI/media/1263923/content/arcmedia/electronic-records/rg-064/asnf/100.1ND_NC.pdf?download=false) for further information.

```{r, include = F}
height_plot <- enlistment_records_final %>%
  ggplot(aes(x = height)) +
  geom_histogram(breaks = seq(0,100,1)) +
  theme_minimal(base_size = 15) +
  ggtitle("Height") +
  scale_y_continuous(labels = scales::comma)
  
```

\vspace{75pt}

```{r, echo = F}
height_plot
```



\newpage
**\huge weight\_or\_AGCT\_enlistment**
\normalsize
\vspace{12pt}

**Label**: Weight (pounds) at enlistment or AGCT score

**Description**: weight_or_AGCT_enlistment is a numeric variable that reports a person's weight in pounds at time of enlistment or their Army General Classification Test (AGCT) score, as reported in the World War II Army Enlistment Records. 

**Note**: Please be aware that instructions on how to use this field on enlistment punch cards varied over time. This field was explicitly used for both weight and AGCT scores, but may also encode military occupation or other information. Weight may have been recorded through about 1943 at some enlistment sites, but the recording of AGCT score instead of weight at some enlistment sites likely began in March 1943. Refer to the [\textcolor{blue}{National Archives' technical documentation on the Amy Serial Number Electronic File}](https://catalog.archives.gov/OpaAPI/media/1263923/content/arcmedia/electronic-records/rg-064/asnf/100.1ND_NC.pdf?download=false) for further information.

```{r, include = F}
weight_plot <- enlistment_records_final %>%
  ggplot(aes(x = weight_or_AGCT)) +
  geom_histogram(breaks = seq(0,1000,10)) +
  theme_minimal(base_size = 15) +
  ggtitle("Weight or AGCT Score") +
  scale_y_continuous(labels = scales::comma)
  
```

\vspace{75pt}

```{r, echo = F}
weight_plot
```



\newpage
**\huge component_enlistment**
\normalsize
\vspace{12pt}

**Label**: Army Component

**Description**:  component_enlistment is a numeric variable that records the component of the army in which an individual served, as recorded in the World War II Army Enlistment Records. 


```{r}
component_codes <- fread('cl_2078.csv')
component_tabulated <- knitr::kable(enlistment_records_final %>%
                          group_by(component) %>% 
                          tally() %>% 
                          left_join(component_codes, by=c('component' = 'Code')) %>%
                          mutate(freq = signif(n*100 / sum(n), 3)) %>% 
                          select(component, 'label' = Meaning, n, `freq %` = freq),
                          format='latex', booktabs=T) %>% 
  kable_styling(position = "center") %>% 
  column_spec(column=2, width = '7cm')
```

\vspace{30 pt}

```{r}
component_tabulated
```


Codes also available at: https://aad.archives.gov/aad/popup-codelist.jsp?cl_id=2078&dt=929&c_id=25014

\newpage


**\huge source**
\normalsize
\vspace{12pt}

**Label**: Source of army personnel

**Description**: source is a string variable that reports the source of the enlisted person, as reported in the World War II Army Enlistment Records. 

Codes also available at: https://aad.archives.gov/aad/popup-codelist.jsp?cl_id=2077&dt=893&c_id=24981

