<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Casey Breen (caseybreen@berkeley.edu)" />

<meta name="date" content="2023-12-07" />

<title>OLS Regression with Truncated CenSoc Data</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">OLS Regression with Truncated CenSoc
Data</h1>
<h4 class="author">Casey Breen (<a href="mailto:caseybreen@berkeley.edu" class="email">caseybreen@berkeley.edu</a>)</h4>
<h4 class="date">2023-12-07</h4>



<p><strong>Summary</strong>: This vignette presents a method for
calculating mortality differentials using Ordinary Least Squares (OLS)
regression on age of death. The goal of this vignette is to highlight
the need for adjustment factors for interpreting OLS Regression
coefficients when working with truncated data and work through a
stylized example using this method to explore the relationship between
wage income and longevity in the CenSoc-Numident dataset.</p>
<p>Before getting started with the vignette, make sure to:</p>
<ul>
<li><p><a href="https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/I0TLPI">Download</a>
the CenSoc-Numident File</p></li>
<li><p><a href="https://usa.ipums.org/usa/">Download</a> the IPUMS 1940
full count census and DDI</p></li>
<li><p>Follow the instructions in the <code>ipumsr</code> vignette [TODO
link] to merge the CenSoc-Numident and Census files</p></li>
<li><p>Install packages if necessary (use the
<code>install.packages()</code> function)</p>
<ul>
<li><code>tidyverse</code></li>
<li><code>ipumsr</code><br />
</li>
<li><code>brooms</code><br />
</li>
<li><code>devtools</code></li>
<li><code>data.table</code></li>
</ul></li>
</ul>
<p>The original R notebook (.Rmd file) for this vignette can be
downloaded <a href="https://github.com/caseybreen/censocdev/tree/master/vignettes/website_vignettes">here</a>.</p>
<div id="setup" class="section level2">
<h2>Setup</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Library Packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="do">## Tools for data analysis</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ipumsr)    <span class="do">## Reads in IPUMS data</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)     <span class="do">## Cleans regression output </span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(devtools)  <span class="do">## R package development tools</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)<span class="do">## Tools for working with big data</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(devtools)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Set seed for reproducibility </span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="fl">0.4886</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Source some files from a GitHub Repository</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">source_url</span>(<span class="st">&quot;https://github.com/caseybreen/numident_paper/tree/master/code/helper_functions.R?raw=TRUE&quot;</span>)</span></code></pre></div>
</div>
<div id="ols-regression-truncation" class="section level2">
<h2>OLS Regression Truncation</h2>
<p>Using OLS Regression on age of death with fixed effect terms for each
year of birth is a straightforward method for analyzing CenSoc mortality
data. There are a few specific considerations of using regression on age
of death to analyze the CenSoc Mortality data. The CenSoc-Numident file
only includes deaths occurring in the window of 1988-2005 (the period
with high death coverage). As the left and right truncation ages vary by
birth cohort, it is important to include fixed effect terms for each
year of birth. Models of the form:</p>
<p><span class="math display">\[ Age\_at\_death = birth\_year\_dummy +
covariates\_of\_interest \]</span></p>
<p>provide estimates of the effect of the covariates on the age of death
in the sample, controlling for birth cohort truncation effects. In this
example, we work with the cohorts of 1900-1920, so we need to include a
fixed effect term for year of birth.</p>
<p>As the truncated window of deaths excludes the tails of the mortality
distribution, any measurement of the average difference between groups
will be downwardly biased. Imagine there are two types of lobsters: red
lobsters with an average weight of 5 pounds and blue lobsters with an
average weight of 2 pounds. Lobster fishers aren’t able to sell lobsters
that are too small or too large — so they catch only lobsters between 3
and 4 pounds. If we just look at the lobsters that are caught, we’re
observing only small red lobsters and big blue lobsters. If we compare
the size of the caught lobsters, we would be understating the true
difference in size between the red and blue lobsters. By the same logic,
the coefficients in our OLS regression model will underestimate the size
of the true effect.</p>
<p><img src="figures/distribution_age_of_death.png" style="width:100.0%" /> For example, in the Figure above, we show two
distributions of age of death in which population A (solid line) has an
e65 — life expectancy at age 65 — of 18 years and population B (dashed
line) has an e65 of 19 years. If we only observe deaths from ages 78 to
95, as we would for the cohort of 1910, the difference in these
truncated means would only be 0.358, understating the e65 difference by
a factor of 2.79. Bearing this in mind, we’ll use 2.79 as our adjustment
factor.</p>
<p>To account for this, we can calculate adjustment factors to help us
more accurately interpret our regression coefficients. Users can do
their full statistical analysis and then apply regression coefficients
to help us better interpret our results.</p>
</div>
<div id="calculating-regression-coefficient-adjustment-factors" class="section level2">
<h2>Calculating Regression Coefficient Adjustment Factors</h2>
<p>We will step through calculating regression adjustment coefficients.
First, we’ll decide upon the appropriate parameters for the Gompertz
model — a popular old age mortality model. In general, we can just use
default values to calculate our mortality parameters. The Gompertz
parameters can be left at their default values of <span class="math inline">\(\beta = 0.1\)</span> and <span class="math inline">\(M = 84\)</span> unless there is a reason to
override these values based on external estimates.</p>
<p>For demonstration purposes, in this vignette, we’ll use maximum
likelihood estimation to calculate new Gompertz parameters from the
birth cohort of 1910. We’ll then use simulation to calculate adjustment
factors for this data set. For a more detailed discussion of this
maximum likelihood estimation method, see the <a href="https://censoc.berkeley.edu/wp-content/uploads/2022/02/bunmd_paper_feb10_2022.pdf">“The
Berkeley Unified Numident Mortality Database”</a> working paper.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Format data for maximum likelihood estimation</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>censoc_numident_demo<span class="ot">&lt;-</span><span class="fu">fread</span>(<span class="st">&quot;/data/censoc/censoc_data_releases/censoc_linked_to_census/v2.1/censoc_numident_v2.1_linked.csv&quot;</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>deaths_tabulated <span class="ot">&lt;-</span> censoc_numident_demo <span class="sc">%&gt;%</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(byear <span class="sc">%in%</span> <span class="dv">1910</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(death_age) <span class="sc">%&gt;%</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">deaths =</span> <span class="fu">sum</span>(weight)) <span class="sc">%&gt;%</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(death_age <span class="sc">%in%</span> <span class="dv">78</span><span class="sc">:</span><span class="dv">94</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">deframe</span>()</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Maximum Likelihood Estimation</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>x.left <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">as.numeric</span>(<span class="fu">names</span>(deaths_tabulated)))</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>x.right <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">as.numeric</span>(<span class="fu">names</span>(deaths_tabulated))) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Truncation </span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">counts.trunc.gomp.est</span>(deaths_tabulated, <span class="at">x.left =</span> x.left,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>                             <span class="at">x.right =</span> x.right,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>                             <span class="at">b.start =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">9</span>, <span class="at">M.start =</span> <span class="dv">80</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Get Gompertz Parameters</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>(b.vec <span class="ot">&lt;-</span> <span class="fu">exp</span>(out<span class="sc">$</span>par[<span class="dv">1</span>]))</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>(M.vec <span class="ot">&lt;-</span> <span class="fu">exp</span>(out<span class="sc">$</span>par[<span class="dv">2</span>]))</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="do">## Get adjustment Factor</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>adjust.factor <span class="ot">&lt;-</span> <span class="fu">get.bunmd.adjust.factor</span>(<span class="dv">1905</span><span class="sc">:</span><span class="dv">1915</span>,</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>                        <span class="at">M =</span> M.vec,</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>                        <span class="at">b =</span> b.vec,</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>                        <span class="at">N =</span> <span class="dv">1000000</span>)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.09249799</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 84.30276</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;simulating: please be patient&quot;</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;regressing: please continue to be patient&quot;</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 3.44</span></span></code></pre></div>
</div>
<div id="mortality-differentials-by-relative-wage-income" class="section level2">
<h2>Mortality Differentials by Relative Wage Income</h2>
<p>The association between relative wage income and mortality in the US
has been well-documented. Can we see this association in our
CenSoc-Numident dataset?</p>
<p>To answer this question, we’ll use the <code>INCWAGE</code> variable.
This is an imperfect measure of income, as it was only collected for
salary and wage workers. Census enumerators in 1940 were explicitly
instructed to “not include earnings of businessmen, farmers, or
professional persons who depend upon business profits, sales of crops,
or fees for income and who do not work for wages or salaries.” (See <a href="https://usa.ipums.org/usa/voliii/inst1940.shtml#584">instructions
to enumeration</a> for more detail). In this analysis, we account for
this by only including persons with non-zero wages — other researchers
may take a different approach.</p>
<p>The CenSoc-Numident file is already restricted to deaths occurring in
the “high-coverage” period of 1988-2005. We further restrict this
analysis to the birth cohorts of 1905 to 1915 and deaths for persons 65+
(these are the birth cohorts and ages at death for which we have the
best death coverage).</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate income deciles</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Restrict to cohorts of 1900-1920</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>censoc_incwage <span class="ot">&lt;-</span> censoc_numident_demo <span class="sc">%&gt;%</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(byear <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1905</span><span class="sc">:</span><span class="dv">1915</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(dyear <span class="sc">&gt;=</span> <span class="dv">65</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(INCWAGE <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> INCWAGE <span class="sc">&lt;=</span> <span class="dv">5001</span>) <span class="sc">%&gt;%</span> <span class="do">## INCWAGE is topcoded at $5001; higher values denote NA/Missing</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wage_decile =</span> <span class="fu">ntile</span>(INCWAGE, <span class="dv">10</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wage_decile =</span> <span class="fu">as.factor</span>(wage_decile)) <span class="sc">%&gt;%</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">educ_yrs =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#EDUCD== 2 ~ 0,</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  EDUCD<span class="sc">==</span> <span class="dv">14</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  EDUCD<span class="sc">==</span> <span class="dv">15</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  EDUCD<span class="sc">==</span> <span class="dv">16</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  EDUCD<span class="sc">==</span> <span class="dv">17</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  EDUCD<span class="sc">==</span> <span class="dv">22</span> <span class="sc">~</span> <span class="dv">5</span>,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  EDUCD<span class="sc">==</span> <span class="dv">23</span> <span class="sc">~</span> <span class="dv">6</span>,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  EDUCD<span class="sc">==</span> <span class="dv">25</span> <span class="sc">~</span> <span class="dv">7</span>,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  EDUCD<span class="sc">==</span> <span class="dv">26</span> <span class="sc">~</span> <span class="dv">8</span>,</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  EDUCD<span class="sc">==</span> <span class="dv">30</span> <span class="sc">~</span> <span class="dv">9</span>,</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  EDUCD<span class="sc">==</span> <span class="dv">40</span> <span class="sc">~</span> <span class="dv">10</span>,</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  EDUCD<span class="sc">==</span> <span class="dv">50</span> <span class="sc">~</span> <span class="dv">11</span>,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  EDUCD<span class="sc">==</span> <span class="dv">60</span> <span class="sc">~</span> <span class="dv">12</span>,</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  EDUCD<span class="sc">==</span> <span class="dv">70</span> <span class="sc">~</span> <span class="dv">13</span>,</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  EDUCD<span class="sc">==</span> <span class="dv">80</span> <span class="sc">~</span> <span class="dv">14</span>,</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  EDUCD<span class="sc">==</span> <span class="dv">90</span> <span class="sc">~</span> <span class="dv">15</span>,</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  EDUCD<span class="sc">==</span> <span class="dv">100</span> <span class="sc">~</span> <span class="dv">16</span>,</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  EDUCD<span class="sc">==</span> <span class="dv">110</span> <span class="sc">~</span> <span class="dv">17</span>,</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  EDUCD <span class="sc">==</span> <span class="dv">111</span> <span class="sc">~</span> <span class="dv">19</span>,</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  EDUCD <span class="sc">==</span> <span class="dv">112</span> <span class="sc">~</span> <span class="dv">20</span>,</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  EDUCD <span class="sc">==</span> <span class="dv">113</span> <span class="sc">~</span> <span class="dv">21</span>,</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="do">## Prepare data for model</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>censoc_incwage <span class="ot">&lt;-</span> censoc_incwage <span class="sc">%&gt;%</span> </span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">race_string =</span> <span class="fu">as_factor</span>(RACE),</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>         <span class="at">bpl_string =</span> <span class="fu">as_factor</span>(BPL),</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>         <span class="at">sex_string =</span> <span class="fu">as_factor</span>(SEX),</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>         <span class="at">byear =</span> <span class="fu">as_factor</span>(byear))</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="do">## print out variables for model</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>censoc_incwage <span class="sc">%&gt;%</span> </span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(death_age, byear, sex_string, race_string, bpl_string, sex_string, educ_yrs) <span class="sc">%&gt;%</span> </span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="dv">6</span>)</span></code></pre></div>
<table>
<colgroup>
<col width="12%" />
<col width="7%" />
<col width="13%" />
<col width="36%" />
<col width="17%" />
<col width="11%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">death_age</th>
<th align="right">byear</th>
<th align="left">sex_string</th>
<th align="left">race_string</th>
<th align="left">bpl_string</th>
<th align="right">educ_yrs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">83</td>
<td align="right">1914</td>
<td align="left">Male</td>
<td align="left">White</td>
<td align="left">Indiana</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="right">86</td>
<td align="right">1913</td>
<td align="left">Male</td>
<td align="left">Black/African American</td>
<td align="left">Mississippi</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">79</td>
<td align="right">1911</td>
<td align="left">Female</td>
<td align="left">White</td>
<td align="left">Maine</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="right">78</td>
<td align="right">1915</td>
<td align="left">Male</td>
<td align="left">White</td>
<td align="left">Tennessee</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="right">73</td>
<td align="right">1914</td>
<td align="left">Female</td>
<td align="left">White</td>
<td align="left">Massachusetts</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="right">84</td>
<td align="right">1915</td>
<td align="left">Male</td>
<td align="left">White</td>
<td align="left">Montana</td>
<td align="right">12</td>
</tr>
</tbody>
</table>
<p>Here, we’ll run our regression and inflate our regression
coefficients and standard errors by our adjustment factor of 3.1.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Run linear model </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Use both IPUMS and CenSoc weights</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(death_age <span class="sc">~</span>  wage_decile <span class="sc">+</span>  byear <span class="sc">+</span> race_string <span class="sc">+</span> sex_string</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="sc">+</span> educ_yrs <span class="sc">+</span> bpl_string,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> censoc_incwage,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">weight =</span> weight) </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Put model results into a data.frame </span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>model.df <span class="ot">&lt;-</span> <span class="fu">tidy</span>(model, <span class="at">conf.int =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">estimate_adj =</span> estimate <span class="sc">*</span> adjust.factor,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">std.error_adj =</span> std.error <span class="sc">*</span> adjust.factor)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Select coefficients and standard errors from OLS model</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>model.df <span class="ot">&lt;-</span> model.df <span class="sc">%&gt;%</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(term, <span class="st">&quot;wage_decile&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(term, <span class="dv">12</span>, <span class="dv">15</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(quantile, <span class="at">value =</span> estimate, <span class="at">value_adj =</span> estimate_adj, std.error, <span class="at">std.error_adj =</span> std.error_adj) <span class="sc">%&gt;%</span> </span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">quantile =</span> <span class="dv">1</span>, <span class="at">value =</span> <span class="dv">0</span>, <span class="at">std.error =</span> <span class="dv">0</span>, <span class="at">value_adj =</span> <span class="dv">0</span>, <span class="at">std.error_adj =</span> <span class="dv">0</span>)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot </span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>income_decile_ols_coefficients <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> model.df) <span class="sc">+</span> </span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> value <span class="sc">-</span> std.error,</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymax =</span> value <span class="sc">+</span> std.error,</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> value,</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>                      <span class="at">x =</span> quantile, </span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>                      <span class="at">color =</span> <span class="st">&quot;Raw&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> value_adj <span class="sc">-</span> std.error_adj,</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymax =</span> value_adj <span class="sc">+</span> std.error_adj,</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> value_adj,</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>                      <span class="at">x =</span> quantile,</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>                      <span class="at">color =</span> <span class="st">&quot;Adjusted&quot;</span>)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>                  ) <span class="sc">+</span> </span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">18</span>) <span class="sc">+</span> </span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Income pattern of Longevity at Age 65&quot;</span>,</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Wage Income Decile&quot;</span>,</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Additional Years of Life&quot;</span>) <span class="sc">+</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">17</span>,<span class="dv">2</span>)) <span class="sc">+</span> </span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">&quot;&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;Adjusted&quot;</span> <span class="ot">=</span> <span class="st">&quot;black&quot;</span>, <span class="st">&quot;Raw&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">plot =</span> income_decile_ols_coefficients, <span class="at">filename =</span> <span class="st">&quot;figures/income_decile_ols_coefficients.png&quot;</span>)</span></code></pre></div>
<center>
<img src="figures/income_decile_ols_coefficients.png" style="width:80.0%" />
<center>
</div>
<div id="interpretation" class="section level2">
<h2>Interpretation</h2>
<p>The plot shows the association between relative wage income and
longevity, after controlling for gender, race, place of birth, and years
of education. The reference group for this plot is the first income
decile. When interpreting these mortality differentials, we should keep
in mind that the plotted adjusted regression coefficients and standard
errors have been scaled-up by a factor of 3.22.</p>
</div>
<div id="conclusion" class="section level2">
<h2>Conclusion</h2>
<p>The CenSoc-Numident dataset allows researchers to explore broad
patterns of mortality differentials in the United States. However, the
truncated mortality distribution presents challenges for mortality
estimation. To overcome this, we use OLS regression with adjustment
factors to scale-up the magnitude of the regression coefficients to
account for the downward bias caused by truncation.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
